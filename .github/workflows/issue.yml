name: want to write

on:
  issues:
    types:
      - opened

jobs:
  set-label:
    name: Set label
    runs-on: ubuntu-22.04
    timeout-minutes: 1
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const issueTitle = context.payload.issue.title;
            const labelsToAdd = [];

            /** 
             * @typedef {Object} Label
             * @property {string} regex - æ¤œç´¢æ–‡å­—åˆ—
             * @property {string} label - ãƒ©ãƒ™ãƒ«å
             */
            /** @type {Label[]} */ 
            const labels = [
              { regex: /Nuxt/i, label: 'Nuxt' },
              # TODO: é¢å€’ãã•ã‹ã£ãŸã®ã§ä¸€æ—¦ã€‚å„ªå…ˆåº¦ã¯é«˜ããªã„ã®ã§æ°—ãŒå‘ã„ãŸã‚‰ç›´ã™
              { regex: /Vue(.js)?/i, label: 'Vue.js' },
              { regex: /UnJS/i, label: 'UnJS' }
            ];

            labels.forEach(label => {
              if (label.regex.test(issueTitle)) {
                console.log(`Math: ${label.label}`);
                labelsToAdd.push(label.label);
              }
            });

            if (labelsToAdd.length > 0) {
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: labelsToAdd
              });
            }
            console.info(`title: ${issueTitle}, labels: ${labelsToAdd.join(',')}`);

  # ref: https://github.com/shinGangan/.github/blob/main/.github/workflows/issue.yml
  set-author:
    needs: [set-label]
    if: ${{ success() && contains(github.event.issue.labels.*.name, 'ğŸ–ï¸ wish author') }}
    permissions:
      contents: read
      issues: write
    uses: shinGangan/.github/.github/workflows/issue.yml@main
    with:
      number: ${{ github.event.issue.number }}
      assignee: ${{ github.actor }}
      milestone: 'articles'
    secrets:
      token: ${{ secrets.GITHUB_TOKEN }}
      repo: ${{ github.repository }}

  set-comment:
    name: Add management comment
    if: ${{ contains(github.event.issue.labels.*.name, 'ğŸ™ please write') }}
    runs-on: ubuntu-22.04
    timeout-minutes: 1
    permissions:
      issues: write
    steps:
      - run: |
          gh issue edit -m 'articles'
          
          gh issue comment $NUMBER -b '<h3>é‹å–¶ã‚³ãƒ¡ãƒ³ãƒˆ</h3>åŸ·ç­†å¸Œæœ›ã‚ã‚Œã° @shinGangan ã‚’ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã—ã¦ãã ã•ã„ã€‚ã‚¢ã‚µã‚¤ãƒ³ã—ã¾ã™ã€‚'
        env:
          NUMBER: ${{ inputs.number }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
